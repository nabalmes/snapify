(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{8076:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return r(7361)}])},7050:function(e,t,r){"use strict";r.d(t,{I:function(){return a},U:function(){return n}});var s=r(5893);function n(e){return(0,s.jsxs)("div",{className:"flex flex-col gap-1 mb-4",children:[(0,s.jsx)("label",{htmlFor:e.id,className:"text-sm font-semibold",children:e.label}),(0,s.jsx)(a,{...e})]})}function a(e){return(0,s.jsx)("input",{...e,className:"border text-sm text-gray-600 bg-gray-50 shadow-sm border-gray-300 px-6 py-2 rounded-md focus:ring-1 focus:ring-blue-600 transition-all outline-none"})}},7361:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return y},default:function(){return j}});var s=r(5893),n=r(8745),a=r(5675),i=r.n(a),o=r(454),d=r(7294),l=r(5149),c=r(6501),u=r(8945),m=r(3299),x=r(1163),p=r(7050),g=r(6893);function h(e){let{setDisplayConfirmBox:t,handleDeleteAccount:r,loading:n}=e;return(0,s.jsxs)("div",{className:"bg-white z-30 fixed -translate-x-1/2 -translate-y-1/2 left-1/2 top-1/2 p-4 rounded-lg flex items-start gap-3 shadow-xl w-full max-w-[350px]",children:[(0,s.jsx)(g.bcx,{className:"text-red-600 shrink-0 text-3xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm md:text-[15px]",children:"Are you sure do you want to delete your account?"}),(0,s.jsxs)("div",{className:"flex mt-4 items-center gap-2 ml-auto w-fit",children:[(0,s.jsx)("button",{type:"button",onClick:e=>t(!1),className:"py-2 px-4 rounded-md text-gray-600 ring-1 bg-gray-50 hover:bg-gray-100 transition outline-none focus:ring ring-gray-300 text-sm",children:"No"}),(0,s.jsx)("button",{type:"button",onClick:r,className:"bg-red-600 text-white py-2 px-4 rounded-md text-sm transition outline-none hover:bg-red-700 focus:ring focus:ring-red-200",disabled:n,children:"Delete"})]})]})]})}var f=r(5459),b=r(9008),w=r.n(b),y=!0;function j(e){let{data:t}=e,{image:r,username:a,contact:g}=t,[b,y]=(0,d.useState)(!1),[j,N]=(0,d.useState)({}),{handleSubmit:v,handleDeleteAccount:P,loading:C}=function(e,t){let r=(0,x.useRouter)(),[s,n]=(0,d.useState)(!1),a=async s=>{s.preventDefault(),c.ZP.loading("Loading"),n(!0);let a={...t};try{if(t.image){let i=await new Promise(e=>{let r="",s=new FileReader;s.readAsDataURL(t.image),s.onload=()=>{r=s.result,e(r)}});a.image=i}let o=await u.Z.put("/api/users?type=info",a),{success:d,message:l}=o.data;if(!d){c.ZP.dismiss(),n(!1),c.ZP.error(l);return}await (0,m.signIn)("credentials",{redirect:!1,sessionId:e._id}),r.reload()}catch(x){console.error(x.message)}},i=async()=>{try{c.ZP.loading("Loading..."),n(!0);let e=await u.Z.delete("/api/users"),{success:t,message:s}=e.data;if(c.ZP.dismiss(),n(!1),!t){c.ZP.error(s);return}await (0,m.signOut)(),r.push("/signin")}catch(a){console.error(a.message)}};return{handleSubmit:a,handleDeleteAccount:i,loading:s}}(t,j),[_,Z]=(0,d.useState)({image:!1,password:!1,inputs:!1}),k=[{id:"username",type:"text",name:"username",pattern:"^[a-zA-Z0-9._-]{3,15}$",title:"Letters, numbers, periods, underscores, and dashes. Must be between 3-15 characters in length",label:"Username",placeholder:"Enter new username",defaultValue:a,onChange:e=>S(e.currentTarget),required:!0},{id:"contact",type:"text",name:"contact",pattern:"^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+.[A-Z|a-z]{2,}|[0-9]*$",title:"Enter your email or phone number only",label:"Contact",placeholder:"Enter new email or phone",defaultValue:g,onChange:e=>S(e.currentTarget),required:!0},{id:"currentPassword",type:"password",name:"currentPassword",placeholder:"Current password",required:_.password,onChange:e=>S(e.currentTarget)},{id:"newPassword",type:"password",placeholder:"New password",name:"newPassword",pattern:"^(?=.*[A-Za-z])(?=.*d)[A-Za-zd]{8,}$",title:"Contains at least one letter and one digit. Must be at least 8 characters in length",required:_.password,onChange:e=>S(e.currentTarget)},{id:"confirmPassword",type:"password",name:"confirmPassword",placeholder:"Confirm password",required:_.password,onChange:e=>S(e.currentTarget)}],S=e=>{let{name:t,value:r,files:s}=e;switch(t){case"image":N({...j,[t]:s[0]}),Z({..._,inputs:!0,image:!0});break;case"currentPassword":case"newPassword":case"confirmPassword":N({...j,[t]:r}),Z({..._,inputs:!0,password:!0});break;default:N({...j,[t]:r}),Z({..._,inputs:!0})}};return(0,s.jsxs)(n.Z,{children:[(0,s.jsx)(w(),{children:(0,s.jsx)("title",{children:"Settings"})}),(0,s.jsx)(c.x7,{}),(0,s.jsx)(f.Z,{}),(0,s.jsxs)("div",{className:"p-7 bg-white rounded-lg shadow-sm",children:[b&&(0,s.jsx)(h,{setDisplayConfirmBox:y,handleDeleteAccount:P,loading:C}),(0,s.jsxs)("main",{className:"md:max-w-[500px] w-full pb-[70px] md:py-0",children:[(0,s.jsxs)("form",{onSubmit:v,className:"mb-12",children:[(0,s.jsx)("h2",{className:"md:text-xl font-bold mb-3",children:"Settings"}),(0,s.jsx)("div",{className:"w-[67px] border border-gray-300 overflow-hidden aspect-square rounded-full mb-3",children:(0,s.jsx)(i(),{src:_.image?URL.createObjectURL(j.image):l.Z+r,alt:"",width:"67",height:"67",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"relative focus-within:ring-1 focus-within:ring-blue-600 border border-gray-300 px-6 py-2 mb-4 rounded-md w-fit",children:[(0,s.jsx)("input",{type:"file",name:"image",accept:"image/*",onChange:e=>S(e.currentTarget),className:"absolute inset-0 opacity-0"}),(0,s.jsx)("p",{className:"text-gray-700 text-sm",children:"Change profile picture"})]}),k.map(e=>{if(e.label)return(0,s.jsx)(p.U,{...e},e.id)}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 mb-3",children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 font-semibold",children:"Change password"}),k.map(e=>{if(!e.label)return(0,s.jsx)(p.I,{...e},e.id)})]}),(0,s.jsx)("button",{type:"submit",className:"".concat(_.inputs?"hover:bg-blue-700 focus:ring text-white bg-blue-600":"border border-gray-300 text-gray-500 pointer-events-none bg-gray-100"," text-sm font-medium py-2 px-6 rounded-md"),disabled:C,children:"Save changes"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-1",children:"Permanently delete this account?"}),(0,s.jsxs)("button",{type:"button",onClick:()=>y(!0),className:"text-red-600 border border-red-300 bg-red-50 flex justify-center text-sm py-2 px-6 rounded-md gap-2 hover:bg-red-100 transition-colors shadow-sm focus:ring-red-300 focus:ring-1 outline-none",children:[(0,s.jsx)(o.xRx,{className:"text-base"}),(0,s.jsx)("span",{children:"Delete account"})]})]})]})]})]})}},9008:function(e,t,r){e.exports=r(3121)}},function(e){e.O(0,[445,13,617,866,556,237,765,945,893,223,774,888,179],function(){return e(e.s=8076)}),_N_E=e.O()}]);