(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[508],{539:function(e,t,s){"use strict";s.d(t,{Z:function(){return k}});var n=s(5893),a=s(5675),r=s.n(a),i=s(7294),c=s(8193),l=s(5434),o=s(1873),u=s(5149);let d={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},h={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},p="mousemove",m="mouseup";function g(e,t){if(0===t)return e;let s=Math.PI/180*t,n=e[0]*Math.cos(s)+e[1]*Math.sin(s),a=e[1]*Math.cos(s)-e[0]*Math.sin(s);return[n,a]}var x={src:"/_next/static/media/blank-image.2d49ba71.png",height:552,width:552,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAAAAADhZOFXAAAAMUlEQVR42kWL2wkAIBRC3X/EgqLUPTIukR8+4IhNRVygbFlEMpKQNWbslt6qFPThdz8A6DjkayumhQAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8};function f(e){let{images:t}=e,[s,a]=(0,i.useState)(0),l=100/t.length*s,o=t.length-1!=0,f=e=>{if("prev"===e){if(0===s)return;a(s-1)}if("next"===e){if(s===t.length-1)return;a(s+1)}},b=function(e){var t,s,n;let a;let{trackMouse:r}=e,c=i.useRef(Object.assign({},h)),l=i.useRef(Object.assign({},d)),o=i.useRef(Object.assign({},l.current));for(a in o.current=Object.assign({},l.current),l.current=Object.assign(Object.assign({},d),e),d)void 0===l.current[a]&&(l.current[a]=d[a]);let[u,x]=i.useMemo(()=>(function(e,t){let s=t=>{let s="touches"in t;s&&t.touches.length>1||e((e,a)=>{a.trackMouse&&!s&&(document.addEventListener(p,n),document.addEventListener(m,i));let{clientX:r,clientY:c}=s?t.touches[0]:t,l=g([r,c],a.rotationAngle);return a.onTouchStartOrOnMouseDown&&a.onTouchStartOrOnMouseDown({event:t}),Object.assign(Object.assign(Object.assign({},e),h),{initial:l.slice(),xy:l,start:t.timeStamp||0})})},n=t=>{e((e,s)=>{let n="touches"in t;if(n&&t.touches.length>1)return e;if(t.timeStamp-e.start>s.swipeDuration)return e.swiping?Object.assign(Object.assign({},e),{swiping:!1}):e;let{clientX:a,clientY:r}=n?t.touches[0]:t,[i,c]=g([a,r],s.rotationAngle),l=i-e.xy[0],o=c-e.xy[1],u=Math.abs(l),h=Math.abs(o),p=(t.timeStamp||0)-e.start,m=u>h?l>0?"Right":"Left":o>0?"Down":"Up",x="number"==typeof s.delta?s.delta:s.delta[m.toLowerCase()]||d.delta;if(u<x&&h<x&&!e.swiping)return e;let f={absX:u,absY:h,deltaX:l,deltaY:o,dir:m,event:t,first:e.first,initial:e.initial,velocity:Math.sqrt(u*u+h*h)/(p||1),vxvy:[l/(p||1),o/(p||1)]};f.first&&s.onSwipeStart&&s.onSwipeStart(f),s.onSwiping&&s.onSwiping(f);let b=!1;return(s.onSwiping||s.onSwiped||s[`onSwiped${m}`])&&(b=!0),b&&s.preventScrollOnSwipe&&s.trackTouch&&t.cancelable&&t.preventDefault(),Object.assign(Object.assign({},e),{first:!1,eventData:f,swiping:!0})})},a=t=>{e((e,s)=>{let n;if(e.swiping&&e.eventData){if(t.timeStamp-e.start<s.swipeDuration){n=Object.assign(Object.assign({},e.eventData),{event:t}),s.onSwiped&&s.onSwiped(n);let a=s[`onSwiped${n.dir}`];a&&a(n)}}else s.onTap&&s.onTap({event:t});return s.onTouchEndOrOnMouseUp&&s.onTouchEndOrOnMouseUp({event:t}),Object.assign(Object.assign(Object.assign({},e),h),{eventData:n})})},r=()=>{document.removeEventListener(p,n),document.removeEventListener(m,i)},i=e=>{r(),a(e)},c=(e,t)=>{let r=()=>{};if(e&&e.addEventListener){let i=Object.assign(Object.assign({},d.touchEventOptions),t.touchEventOptions),c=[["touchstart",s,i],["touchmove",n,Object.assign(Object.assign({},i),t.preventScrollOnSwipe?{passive:!1}:{})],["touchend",a,i]];c.forEach(([t,s,n])=>e.addEventListener(t,s,n)),r=()=>c.forEach(([t,s])=>e.removeEventListener(t,s))}return r},l=t=>{null!==t&&e((e,s)=>{if(e.el===t)return e;let n={};return e.el&&e.el!==t&&e.cleanUpTouch&&(e.cleanUpTouch(),n.cleanUpTouch=void 0),s.trackTouch&&t&&(n.cleanUpTouch=c(t,s)),Object.assign(Object.assign(Object.assign({},e),{el:t}),n)})},o={ref:l};return t.trackMouse&&(o.onMouseDown=s),[o,c]})(e=>c.current=e(c.current,l.current),{trackMouse:r}),[r]);return c.current=(t=c.current,s=l.current,n=o.current,s.trackTouch&&t.el?t.cleanUpTouch?s.preventScrollOnSwipe!==n.preventScrollOnSwipe||s.touchEventOptions.passive!==n.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:x(t.el,s)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:x(t.el,s)}):(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0}))),u}({onSwipedLeft:()=>f("next"),onSwipedRight:()=>f("prev")});return(0,n.jsxs)("div",{className:"relative overflow-hidden",children:[(0,n.jsx)(r(),{src:x,alt:"",width:400,height:400,className:"absolute w-full h-full inset-0",priority:!0}),(0,n.jsx)("div",{...b,style:{transform:"translateX(-".concat(l,"%)"),width:"".concat(100*t.length,"%")},className:"relative transition-transform ease-in-out flex",children:t.map((e,s)=>(0,n.jsx)("div",{className:"aspect-square w-full h-full",children:(0,n.jsx)(r(),{src:u.Z+t[s],alt:"",width:400,height:400,className:"w-full h-full object-cover"})},s))}),o&&(0,n.jsxs)(n.Fragment,{children:[["prev","next"].map(e=>(0,n.jsx)("button",{type:"button",className:"".concat("prev"===e?"left-4":"right-4"," -translate-y-1/2 absolute top-1/2  text-gray-400 text-2xl bg-black/[.25] rounded-full p-2 hover:bg-black/[.30] active:bg-black/[.25]"),onClick:()=>f(e),children:"prev"===e?(0,n.jsx)(c.CF5,{className:"text-white"}):(0,n.jsx)(c.Td4,{className:"text-white"})},e)),(0,n.jsx)("div",{className:"absolute z-10 left-1/2 -translate-x-1/2 bottom-6 flex items-center gap-2 opacity",children:t.map((e,t)=>(0,n.jsx)("div",{className:"".concat(t===s?"w-3 h-3":"w-2 h-2"," rounded-full bg-black/[.25] transition-all")},t))})]})]})}var b=s(381),v=s.n(b),w=s(8945),j=s(1664),y=s.n(j),N=s(1163),O=s(6118);async function S(e,t,s){try{let n=(0,O.Z)(e,{...t,page:s,noSkip:!0}),a=await w.Z.get(n);return a.data.posts}catch(r){console.error(r)}}function k(e){let{session:t,post:s,actions:a,setPosts:d}=e,{_id:h,authorId:p,author:m,topics:g,content:{caption:x,images:b},likes:j,comments:O,createdAt:k}=s,{image:A,username:E}=m,[T,U]=(0,i.useState)(!1),[M,L]=(0,i.useState)(!1),R=(0,i.useRef)(null),[D,Z]=(0,i.useState)(!1),[C,I]=(0,i.useState)(3),_=O.slice(0,C),{loading:q,handleFollow:F,handleLike:Q,handleComment:B}=function(e,t,s,n,a,r){let c=(0,N.useRouter)(),{baseUrl:l,query:o,page:u}=a,[d,h]=(0,i.useState)({follow:!1,like:!1,comment:!1}),p=async()=>{if(!e){c.push("/signin");return}h({...d,follow:!0});try{await w.Z.put("/api/users?type=follow&authorId=".concat(s));let t=await S(l,o,u);h({...d,follow:!1}),r(t)}catch(n){console.error(n.message)}},m=async s=>{try{if(s.preventDefault(),!e){c.push("/signin");return}let{value:a}=t.current;h({...d,comment:!0}),await w.Z.put("/api/post/".concat(n,"?type=comment"),{comment:a}),t.current.value="";let i=await S(l,o,u);h({...d,comment:!1}),r(i)}catch(p){console.error(p.message)}},g=async()=>{try{e||c.push("/signin"),h({...d,like:!0}),await w.Z.put("/api/post/".concat(n,"?type=like"));let t=await S(l,o,u);h({...d,like:!1}),r(t)}catch(s){console.error(s.message)}};return{loading:d,handleFollow:p,handleLike:g,handleComment:m}}(t,R,p,h,a,d);return(0,i.useEffect)(()=>{if(!t){L(!1);return}let e=j.some(e=>e===t._id);L(e)},[j,t]),(0,i.useEffect)(()=>{if(!t){U(!1);return}let e=async()=>{let e=await w.Z.get("/api/users/".concat(t._id)),s=e.data.user.following.some(e=>e===p);U(s)};e()},[s]),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"px-4 md:px-7",children:[(0,n.jsxs)("div",{className:"justify-between flex items-start mb-3",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsx)("div",{className:"aspect-square overflow-hidden w-[40px] rounded-full border border-gray-300",children:(0,n.jsx)(r(),{src:u.Z+A,alt:"avatar",width:"40",height:"40",className:"object-cover w-full h-full"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(y(),{href:"/user/".concat(E),className:"font-bold text-sm md:text-[15px] hover:text-blue-600 transition-colors",children:E}),(0,n.jsx)("p",{className:"text-sm text-gray-400",children:v()(k).fromNow()})]})]}),p!==(null==t?void 0:t._id)&&(0,n.jsxs)("button",{type:"button",onClick:F,className:"".concat(q.follow?"text-gray-400 bg-gray-100":"text-blue-600 bg-blue-600/[.10] hover:bg-blue-600/[.20]","  font-medium  py-2 px-4 text-sm rounded-lg transition-colors"),disabled:q.follow,children:["Follow",T&&"ed"]})]}),(0,n.jsx)("p",{className:"mb-2 text-[15px] text-gray-600",children:x}),(0,n.jsx)("div",{className:"flex gap-2 mb-2",children:0!==g&&g.map((e,t)=>(0,n.jsxs)(y(),{href:"/search?value=".concat(e),className:"text-blue-600 text-[15px] hover:underline",children:["#",e]},t))})]}),(0,n.jsx)(f,{images:b}),(0,n.jsxs)("div",{className:"px-7",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2 gap-4 py-4",children:[(0,n.jsxs)("button",{type:"button",onClick:Q,className:"group flex text-[15px] items-center gap-2",disabled:q.like,children:[M?(0,n.jsx)(c.M_L,{className:"text-xl text-gray-500 group-hover:text-blue-600 transition-colors"}):(0,n.jsx)(c.lo,{className:"text-xl text-gray-500 group-hover:text-blue-600 transition-colors"}),(0,n.jsxs)("span",{className:"text-sm md:text-[15px] text-gray-700 group-hover:text-blue-600 transition-colors",children:[j.length," Like",j.length>1&&"s"]})]}),(0,n.jsxs)("button",{type:"button",className:"group flex items-center text-[15px] gap-2 text-gray-700 hover:text-blue-600 transition-colors",onClick:()=>Z(!D),children:[(0,n.jsx)(o.THQ,{className:"text-gray-500 group-hover:text-blue-600 transition-colors"}),(0,n.jsxs)("span",{className:"text-sm md:text-[15px] text-gray-700 group-hover:text-blue-600 transition-colors",children:[O.length," Comment",O.length>1&&"s"]})]})]}),(0,n.jsxs)("div",{className:"".concat(D?"block":"hidden"),children:[0!==_&&_.map(e=>{let{_id:t,commenterId:s,commenter:{username:a,image:i},comment:c,createdAt:l}=e;return(0,n.jsxs)("div",{className:"flex items-start gap-2 mb-4",children:[(0,n.jsx)("div",{className:"aspect-square overflow-hidden w-[45px] rounded-full",children:(0,n.jsx)(r(),{src:u.Z+i,alt:"",className:"w-full h-full object-cover",width:"45",height:"45"})}),(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex gap-4 justify-between",children:[(0,n.jsx)(y(),{href:"/user/".concat(a),className:"font-bold hover:text-blue-600 transition-colors text-sm md:text-[15px]",children:a}),(0,n.jsx)("span",{className:"text-sm text-gray-400",children:v()(l).fromNow()})]}),(0,n.jsx)("p",{className:"text-sm md:text-[15px] text-gray-600",children:c})]})]},t)}),C<O.length&&(0,n.jsx)("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>I(C+3),children:"Show more"}),(0,n.jsxs)("form",{onSubmit:B,className:"border mt-4 justify-between flex items-center rounded-lg px-2 border-gray-200 focus-within:ring-1 transition focus-within:ring-blue-700 overflow-hidden mb-6",children:[(0,n.jsx)("input",{type:"text",placeholder:"Add comment",maxLength:"64",ref:R,required:!0,className:"p-3 min-w-0 grow outline-none text-sm text-gray-700"}),(0,n.jsx)("button",{type:"submit",className:"rounded-md p-2 w-8 hover:bg-gray-200 aspect-square transition-colors",disabled:q.comment,children:(0,n.jsx)(l.D6S,{className:"text-lg text-blue-600"})})]})]})]})]})}},9029:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var n=s(8945),a=s(7294),r=s(6118);function i(e,t){let[s,i]=(0,a.useState)([]),[c,l]=(0,a.useState)(2),[o,u]=(0,a.useState)(!0),d="/api/post",h=async()=>{try{let e=(0,r.Z)(d,{...t,page:c}),a=await n.Z.get(e);if(0===a.data.posts.length){u(!1);return}i([...s,...a.data.posts]),l(c+1)}catch(o){console.error(o)}};return(0,a.useEffect)(()=>{if(0!==s.length&&o)return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e);function e(){let{scrollTop:e,offsetHeight:t}=document.documentElement,s=1>=Math.abs(window.innerHeight+e-t);s&&h()}0!==s.length||o||u(!1)},[s.length,o]),(0,a.useEffect)(()=>{u(!0),l(2),i(e)},[e]),{baseUrl:d,page:c,posts:s,setPosts:i,hasMore:o}}},6118:function(e,t){"use strict";t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=Object.entries(t).map(e=>{let[t,s]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(s))}).join("&");return s?"".concat(encodeURI(e),"?").concat(s):encodeURI(e)}},9008:function(e,t,s){e.exports=s(3121)}}]);